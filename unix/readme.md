# start
  https://www.linux.com/learn/kernel-newbie-corner-kernel-and-module-debugging-gdb
  http://www.makelinux.net/ldd3/
  https://communities.vmware.com/
  http://sysprogs.com/VisualKernel/tutorials/vmware/  

* umask
	
    * For directories, the base permissions are (rwxrwxrwx) 0777 
	* for files they are 0666 (rw-rw-rw).
	```bash
    # set umask to 077:
	umask u=rwx,g=,o=
    ```

* strace
	strace -ff -e trace=file -o /tmp/trace /etc/init.d/mysqld start 

* iptables
	 
    /sbin/service iptables save

	This executes the iptables init script, which runs the /sbin/iptables-save program and writes the current iptables configuration to /etc/sysconfig/iptables. The existing /etc/sysconfig/iptables file is saved as /etc/sysconfig/iptables.save.

	The next time the system boots, the iptables init script reapplies the rules saved in /etc/sysconfig/iptables by using the /sbin/iptables-restore command.

	While it is always a good idea to test a new iptables rule before committing it to the /etc/sysconfig/iptables file, it is possible to copy iptables rules into this file from another system's version of this file. This provides a quick way to distribute sets of iptables rules to multiple machines. 
    ```shell
    iptables -t nat -I PREROUTING -t tcp --dport 8888 -j REDIRECT --to 80
    iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 \
       -j REDIRECT --to-ports 8080 
    ```

  ## redirect port 5001 to port 110 (POP3) at 123.123.123.123:
    ```bash
    iptables -t nat -A PREROUTING -p tcp --dport 5001 \
    -j DNAT --to-destination 123.123.123.123:110
    ```   
  ## Change sender to redirecting machine:m
    ```bash
    iptables -t nat -A POSTROUTING -p tcp --dport 110 \
       -j MASQUERADE
    ```
  ## netfilter Read more at: http://scl.io/98OfGfTx#gs.gx4n9uY
  
    * tables:
      name   | chains
      ----   | -- 
      FILTER |Input, Output, Forward
      NAT    |Prerouting, Postrouting, Output
      MANGLE | Prerouting, Postrouting, Input, Output, Forward 

    * chains:
      name        | description
      ------------| -----------
      PREROUTING  | Immediately after being received by an interface.
      POSTROUTING | Right before leaving an interface.
      INPUT       | Right before being handed to a local process.
      OUTPUT      | Right after being created by a local process.
      FORWARD     | For any packets coming in one interface and leaving out another.

    * [netfilter](http://www.netfilter.org/documentation/HOWTO/netfilter-hacking-HOWTO-3.html)
      ```
      --->PRE------>[ROUTE]--->FWD---------->POST------>
      Conntrack    |       Mangle   ^    Mangle
      Mangle       |       Filter   |    NAT (Src)
      NAT (Dst)    |                |    Conntrack
      (QDisc)      |             [ROUTE]
                   v                |
                   IN Filter       OUT Conntrack
                   |  Conntrack     ^  Mangle
                   |  Mangle        |  NAT (Dst)
                   v                |  Filter
      ```

  * iptables log
    * Enable Iptables LOG
      ```
      iptables -A INPUT -j LOG
      iptables -A INPUT -s 192.168.10.0/24 -j LOG

      # To define level of LOG generated by iptables us –log-level followed by level number.
      iptables -A INPUT -s 192.168.10.0/24 -j LOG --log-level 4

      # We can also add some prefix in generated Logs, So it will be easy to search for logs in a huge file.
      iptables -A INPUT -s 192.168.10.0/24 -j LOG --log-prefix '** SUSPECT **'

  * View Iptables LOG
    After enabling iptables logs. check following log files to view logs generated by iptables as per your operating system.
    - On Ubuntu and Debian
    ```
    iptables logs are generated by the kernel. So check following kernel log file.
    tailf /var/log/kern.log
    ```
    - On CentOS/RHEL and Fedora
    ```
    cat /var/log/messages
    ```

  * Change Iptables LOG File Name
    ```
    To change iptables log file name edit /etc/rsyslog.conf file and add following configuration in file.
    vi /etc/syslog.conf
    # Add following line
    kern.warning /var/log/iptables.log

    # Now restart rsyslog service using following command.
    service rsyslog restart
    ```

* tcpdump
   - get tcpdump info
      ```
      tcpdump -i any -vvv 'host 192.168.2.1 and (tcp port 67 or 68)'
      tcpdump -lnni any 'udp port 180' -s0 -w - | strings
      ```      

* bash 
  - shortcut
    * Moving the cursor:
      ```
      Ctrl + a   Go to the beginning of the line (Home)
      Ctrl + e   Go to the End of the line (End)
      Ctrl + p   Previous command (Up arrow)
      Ctrl + n   Next command (Down arrow)
      Alt + b   Back (left) one word
      Alt + f   Forward (right) one word
      Ctrl + f   Forward one character
      Ctrl + b   Backward one character
      Ctrl + xx  Toggle between the start of line and current cursor position
      ```

  * Editing:
    ```
    Ctrl + L   Clear the Screen, similar to the clear command

      Alt + Del Delete the Word before the cursor.
      Alt + d   Delete the Word after the cursor.
    Ctrl + d   Delete character under the cursor
    Ctrl + h   Delete character before the cursor (Backspace)

    Ctrl + w   Cut the Word before the cursor to the clipboard.
    Ctrl + k   Cut the Line after the cursor to the clipboard.
    Ctrl + u   Cut/delete the Line before the cursor to the clipboard.

      Alt + t   Swap current word with previous
    Ctrl + t   Swap the last two characters before the cursor (typo).
    Esc  + t   Swap the last two words before the cursor.

    ctrl + y   Paste the last thing to be cut (yank)
      Alt + u   UPPER capitalize every character from the cursor to the end of the current word.
      Alt + l   Lower the case of every character from the cursor to the end of the current word.
      Alt + c   Capitalize the character under the cursor and move to the end of the word.
      Alt + r   Cancel the changes and put back the line as it was in the history (revert).
    ctrl + _   Undo
    ```
  
  * TAB        Tab completion for file/directory names
      For example, to move to a directory 'sample1'; Type cd sam ; then press TAB and ENTER.
      type just enough characters to uniquely identify the directory you wish to open.

  * Special keys: Tab, Backspace, Enter, Esc
    ```
    Text Terminals send characters (bytes), not key strokes.
    Special keys such as Tab, Backspace, Enter and Esc are encoded as control characters.
    Control characters are not printable, they display in the terminal as ^ and are intended to have an effect on applications.

    Ctrl+I = Tab
    Ctrl+J = Newline
    Ctrl+M = Enter
    Ctrl+[ = Escape

    Many terminals will also send control characters for keys in the digit row:
    Ctrl+2 → ^@
    Ctrl+3 → ^[ Escape
    Ctrl+4 → ^\
    Ctrl+5 → ^]
    Ctrl+6 → ^^
    Ctrl+7 → ^_ Undo
    Ctrl+8 → ^? Backward-delete-char

    Ctrl+v tells the terminal to not interpret the following character, so Ctrl+v Ctrl-I will display a tab character,
    similarly Ctrl+v ENTER will display the escape sequence for the Enter key: ^M
    ```

  * History:
    ```
    Ctrl + r   Recall the last command including the specified character(s)
              searches the command history as you type.
              Equivalent to : vim ~/.bash_history. 
    Ctrl + p   Previous command in history (i.e. walk back through the command history)
    Ctrl + n   Next command in history (i.e. walk forward through the command history)

    Ctrl + s   Go back to the next most recent command.
              (beware to not execute it from a terminal because this will also launch its XOFF).
    Ctrl + o   Execute the command found via Ctrl+r or Ctrl+s
    Ctrl + g   Escape from history searching mode
          !!   Repeat last command
        !abc   Run last command starting with abc
      !abc:p   Print last command starting with abc
          !$   Last argument of previous command
    ALT + .   Last argument of previous command
          !*   All arguments of previous command
    ^abc­^­def   Run previous command, replacing abc with def
    ```

  * Process control:
    ```
    Ctrl + C   Interrupt/Kill whatever you are running (SIGINT)
    Ctrl + l   Clear the screen
    Ctrl + s   Stop output to the screen (for long running verbose commands)
                Then use PgUp/PgDn for navigation
    Ctrl + q   Allow output to the screen (if previously stopped using command above)
    Ctrl + D   Send an EOF marker, unless disabled by an option, this will close the current shell (EXIT)
    Ctrl + Z   Send the signal SIGTSTP to the current task, which suspends it.
                To return to it later enter fg 'process name' (foreground).
    ```

  * Emacs mode vs Vi Mode
    ```
    All the above assume that bash is running in the default Emacs setting, if you prefer this can be switched to Vi shortcuts instead.

    Set Vi Mode in bash:

    $ set -o vi 

    Set Emacs Mode in bash:

    $ set -o emacs 
    ```

  - Substring Replacement
    ```
    # removal
    ${string#substring}: Deletes shortest match of $substring from front of $string.
    ${string##substring}: Deletes longest match of $substring from front of $string.

    ${string%substring}: Deletes shortest match of $substring from back of $string.
    ${string%%substring}: Deletes longest match of $substring from back of $string.


    # replacement
    ${string/substring/replacement} : Replace first match of $substring with $replacement
    ${string//substring/replacement}: Replace all matches of $substring with $replacement

    ${string/#substring/replacement}: If $substring matches front end of $string, substitute $replacement for $substring.
    ${string/%substring/replacement}: If $substring matches back end of $string, substitute $replacement for $substring.
    ```

* linux
  * runlevel

    0: halt
    1: single-user
    2: multi-user
    3: multi-user with networking
    4: undefined (user defined)
    5: multi-user with display manager (graphical login)
    6: reboot

  *  Name Service Switch (NSS). 

  * [systemd](https://www.freedesktop.org/wiki/Software/systemd/)
    
    Unit:

    Service

    Install

  * [dns](https://wiki.debian.org/NetworkConfiguration)

    1. The resolvconf program
    2. The network-manager daemon
    3. DHCP clients 

    * The resolv.conf file typically contains the IP addresses of nameservers (DNS name resolvers) that will attempt to translate names into addresses for any node available on the network. There will be a line or lines that look like this:
      ```
      nameserver 12.34.56.78
      nameserver 12.34.56.79
      ```
    * When resolvconf is properly installed, the resolv.conf configuration file at /etc/resolv.conf is replaced by a symbolic link to   /etc/resolvconf/run/resolv.conf and the resolver instead uses the configuration file that is dynamically generated by resolvconf at /etc/resolvconf/run/resolv.conf. 

    * If the resolvconf program is installed, you should not edit the resolv.conf configuration file manually as it will be dynamically changed by programs in the system. If you need to manually define the nameservers (as with a static interface), add a line something like the following to the interfaces configuration file at /etc/network/interfaces: 
      ```
      dns-nameservers 12.34.56.78 12.34.56.79
      ```

  * DHCP Client Configuration

    Example: dhclient3 uses /etc/dhcp/dhclient.conf. The setting you want is

    supersede domain-name-servers 12.34.56.78, 12.34.56.79;

    or perhaps

    prepend domain-name-servers 12.34.56.78, 12.34.56.79;

  * wireshark
    bootp:
      bootp.dhcp 
    udp.port==67
    eth.addr == ff:ff:ff:ff:ff:ff

  * ps
    ```
    %ni for priority upgrade nice
    %st — Steal Time : CPU ‘stolen’ from this virtual machine by the hypervisor for other tasks
    %hi — Hardware IRQ
    %si — Software Interrupts
    %us %sy for user time and system time
    %id for idel

    S – indicates the status of the process: S=sleep R=running Z=zombie (S)
    ```

# ubuntu 16.10 #
  * ppa
    
    personal package archive

    chfn ............... change your "Real Name" as seen on finger
    
    chsh ............... change the shell you log into

    [keystone install](http://docs.openstack.org/liberty/install-guide-ubuntu/keystone-install.html)


* signal
    * Typing Ctrl + C normally causes the shell to send SIGINT to your program
        Ctrl + \ SIGQUIT
    ```bash
    kill -l
    kill -USR1 pid
    kill -USR2 pid
    kill -9 pid
    ```
    * SIGCLD System V:
        not produce zombies process if ignored

    * SIGCHLD bsd,posix.1 adopt bsd: 
        if ingnored produce zombies in bsd, wait child will emit zombies

        A state change is considered to be: the child terminated; the child 
        was stopped by a signal; or the child was resumed by a signal. 
        In the case of a terminated child, performing a wait allows the system 
        to release the resources associated with the child; if a wait is not 
        performed, then the terminated child remains in a "zombie" state (see NOTES below).

        A child that terminates, but has not been waited for becomes a
       "zombie".  The kernel maintains a minimal set of information about
       the zombie process (PID, termination status, resource usage
       information) in order to allow the parent to later perform a wait to
       obtain information about the child.  As long as a zombie is not
       removed from the system via a wait, it will consume a slot in the
       kernel process table, and if this table fills, it will not be
       possible to create further processes.  If a parent process
       terminates, then its "zombie" children (if any) are adopted by
       init(1), which automatically performs a wait to remove the zombies.

* core dump
    ```bash
    sysctl kernel.core_pattern
    # kernel.core_pattern = |/usr/libexec/abrt-hook-ccpp %s %c %p %u %g %t e
    sysctl -p
    ulimit -c unlimited
    ulimit -c 
    ```
  * gdb:
    * compile

        gcc -g -O0 

    * gdb exec_file core_file

        info variable

        info locals

        p <variable name>

        i register (i r)

        info proc map

        disassamble

        set architecture i386:intel
        set disassembly-flavor intel
        ctrl + x + a

     * multiple process:
          set follow-fork-mode child/parent
          set detach-on fork off

     * watch: (same for break print)
      ```
        watch foo
        watch -l foo
        rwatch foo         # stop if foo is read
        watch foo thread 3 # watch if thread 3 modify foo
        watch foo if foo = 3 
      ```

      * thread
      ```
        thread apply 1-4 backtrace/print $sp
        thread apply all backtrace full
      ```
      
      * dynamic printf
        dprintf mutex_lock, ...
        set dprintf-style gdb/call
        set dprintf-channel mylog
        set dprintf-function fprintf

      * catch
        catch syscall nanosleep
        catch syscall 100

        tbreak # temparory break
        rbreak # regex break
        command
        silent # suppress output on breakpoint hit
        info line * $pc
        info line foo.c:42
    D_PRELOAD to the path of a shared object, that file will be loaded before any other library (including the C runtime, libc.so).

      - continue and break
        ```
        break foo if x>0
        commands
        silent
        printf "x is %d\n",x
        cont
        end

        ignore bnum count

        continue [ignore-count](http://web.mit.edu/gnu/doc/html/gdb_7.html)
        c [ignore-count]
        fg [ignore-count] 

        until location
        u location 
        ```

      - calling or reture from a function
        ```
        return
        return expression 

        finish:Continue running until just after function in the selected stack frame returns. Print the returned value (if any). 
        call expr:Evaluate the expression expr without displaying void returned values. 
        ```

    * common commands
      command | description
      --| --
      h[elp] 	     |     Get help on gdb commands
      h[elp]       |     $ <$ cmd$ >$ 	Get help on a specific gdb command
      r[un] 	     |     Run to next breakpoint or to end
      s[tep] 	     |     Single-step, descending into functions
      [ext]        |    	Single-step without descending into functions
      fin[ish] 	   |     Finish current function, loop, etc. (useful!)
      c[ontinue] 	 |     Continue to next breakpoint or end
      up 	         |     Go up one context level on stack (to caller)
      do[wn] 	     |     Go down one level (only possible after up)
      l[ist] 	     |      Show lines of code surrounding the current point
      p[rint] $ <$ name$ >$ |	Print value of variable called $ <$ name$ >$
      p $ \ast<$ name$ >$   |	  Print what is pointed to by $ <$ name$ >$
      p/x $ <$ name$ >$ 	  |  Print value of $ <$ name$ >$ in hex format
      p $ <$ name$ >$ @$ <$ n$ >$ |	print $ <$ n$ >$ values starting at $ <$ name$ >$
      p $ <$ chars$ >$ $ <$ tab$ >$ |	List all variables starting with $ <$ chars$ >$
      b[reak] $ <$ name$ >$ |	Set a breakpoint at function $ <$ name$ >$
      b $ <$ class$ >$ ::$ <$ name$ >$ |	Set a breakpoint at $ <$ name$ >$ in $ <$ class$ >$
      b $ <$ class$ >$ ::$ <$ tab$ >$ |	List all members in $ <$ class$ >$
      h[elp] b |	Documentation for setting breakpoints
      i[nfo] b |	List breakpoints
      i 	| List all info commands
      dis[able] 1 |	Disable breakpoint 1
      en[able] 1  |	Enable breakpoint 1
      d[elete] 1 	| Delete breakpoint 1
      d 1 2       |	Delete breakpoints 1 and 2
      d 	        | Delete all breakpoints
      cond[ition] 1 $ <$ expr$ >$ |	Stop at breakpoint 1 only if $ <$ expr$ >$ is true
      cond 1 |	Make breakpoint 1 unconditional
      comm[ands] 1 	| Add a list of gdb commands to execute each time breakpoint 1 is hit
        (usually just print <var>)

    * debug
      ```
       gdb -ex r --args python <programname>.py <arguments>
      print x=4 # set and print x
      set {int}0x83040 = 4 # set memory in 0x8304
      whatis $ebp
        void *
      
      jump *0x1000

      break *0x7c00 if 

      delete breakpoints 1

      save breakpoints brks.gdb
      source -s brks.gdb   # If -s is specified, then gdb searches for filename on the search path even if filename specifies a directory
      ```

    * frame
      ```
      frame

      info f[rame]
      frame n     select frame
      up n    up n frames
      down n 
      ```

    * Convenience Variables
      gdb provides convenience variables that you can use within gdb to hold on to a value and refer to it later
      - exist entirely within gdb
      - not part of your program
      - has no direct eﬀect on further execution of your program
      - any name preceded by ‘$’ can be used for a convenience variable, unless it is one of the predefned 
        machine-specifc register names 
      ```
      
    * usage:
      - debug daemon
        - vim non-stop.gdb
          ```
          set target-async on
          set pagination off
          set non-stop on
          ```
        
        - run gdb
          ```
          gdb -x non-stop.gdb
          (gdb) !pgrep YOUR-DAEMON
          1234
          (gdb) attach 1234
          (gdb) continue -a &
          (gdb)
          ```

# file system #
    
  * ZFS has three major design goals: https://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/zfs.html

    1. __Data integrity__: All data includes a checksum of the data. When data is written, the checksum is calculated and written along with it. When that data is later read back, the checksum is calculated again. If the checksums do not match, a data error has been detected. ZFS will attempt to automatically correct errors when data redundancy is available.

    2. __Pooled storage__: physical storage devices are added to a pool, and storage space is allocated from that shared pool. Space is available to all file systems, and can be increased by adding new storage devices to the pool.

    3. __Performance__: multiple caching mechanisms provide increased performance. ARC is an advanced memory-based read cache. A second level of disk-based read cache can be added with L2ARC, and disk-based synchronous write cache is available with ZIL.

# network #
 * ppp
    CHAP versus PAP:
    
    With PPP, each system may require its peer to authenticate itself using one of two authentication protocols. These are the Password Authentication Protocol (PAP), and the Challenge Handshake Authentication Protocol (CHAP). When a connection is established, each end can request the other to authenticate itself, regardless of whether it is the caller or the callee. Below I will loosely talk of `client' and `server' when I want to distinguish between the authenticating system and the authenticator. A PPP daemon can ask its peer for authentication by sending yet another LCP configuration request identifying the desired authentication protocol. 

    PAP works basically the same way as the normal login procedure. The client authenticates itself by sending a user name and an (optionally encrypted) password to the server, which the server compares to its secrets database. This technique is vulnerable to eavesdroppers who may try to obtain the password by listening in on the serial line, and to repeated trial and error attacks.

    CHAP does not have these deficiencies. With CHAP, the authenticator (i.e. the server) sends a randomly generated ``challenge'' string to the client, along with its hostname. The client uses the hostname to look up the appropriate secret, combines it with the challenge, and encrypts the string using a one-way hashing function. The result is returned to the server along with the client's hostname. The server now performs the same computation, and acknowledges the client if it arrives at the same result.

    CHAP is doesn't only authenticate client at startup time, but sends challenges at regular intervals to make sure the client hasn't been replaced by an intruder, for instance by just switching phone lines. 

    pppd keeps the secret keys for CHAP and PAP in two separate files, called /etc/ppp/chap-secrets and pap-secrets, respectively

    As CHAP is so much stronger than PAP, pppd tries to use the former whenever possible. If the peer does not support it, or if pppd can't find a CHAP secret for the remote system in its chap-secrets file, it reverts to PAP. If it doesn't have a PAP secret for its peer either, it will refuse to authenticate altogether. As a consequence, the connection is closed down. 

# bash #

  * ls  directories in current
    ```bash
    ls -d */  # list only subdirectories in the current one
    ls -F | grep --color /
    :(){ : &};:
    ```

  * kill a group process
    ```bash
    pids=` ps x -o  "%p %r %c" | grep bash | sort -k 2 | awk '{print $2}' | sort -u `
    for pid in ${pids};do kill -TERM -- -$pid ;done;

    ps -p 6514 -F
    ```

  * redirect
    
    write stdout and stderr to logfie and stderr to stdout:
    /a.out < /etc/services 2>&1 >>stderr.out | tee --append stderr.out
    
  * [anonymize ssh traffic](http://tor.stackexchange.com/questions/123/how-can-i-anonymize-my-ssh-traffic-using-the-tor-network/127#127)

    1. For SSH you can do something like the following:
    ```
    ssh -o ProxyCommand='nc -x localhost:$orport %h %p' example.com
    ```

    2. Options can also be configured in your ~/.ssh/config (or /etc/ssh/ssh_config, or the equivalent on your OS) file:
    ```
    Host example
        Hostname example.com
        ProxyCommand /usr/bin/nc -x localhost:$orport %h %p
    ```

    3. Rsync can then use ssh as its remote shell and it will pick up the previous config:
      ```
      rsync -e ssh example:path/to/files /dest
      ```
      > or, by directly passing arguments to the remote shell:
      
      ```
      rsync -e "ssh -o ProxyCommand='nc -x localhost:$orport %h %p'" example.com /dest
      ```

    4. Finally, you can use the RSYNC_CONNECT_PROG environment variable to set up all future RSYNC invocations to use Tor (without having to manually specify it each time):
        ```
        export RSYNC_CONNECT_PROG='ssh proxyhost nc -x localhost:$orport %h %p'
        rsync example.com:/src /dest 
        ```
       Replace $orport with the port you've got Tor's SOCKS proxy listening on.

  - ssh auto start config in debian
    ```
    show init process info
    insser -s | grep ssh
    update-rc.d -f ssh remove
    # start in runlevel 2,3,4,5 and stop in runlevel 0,1,6
    update-rc.d ssh start 20 2 3 4 5 . stop 10 0 1 6
    # configure file in rcX.d, K for stop, S for start
    find /etc/ -type l | grep ssh
    /etc/rc4.d/S17ssh
    /etc/rc0.d/K01ssh
    /etc/rc1.d/K01ssh
    /etc/rc2.d/S17ssh
    /etc/rc6.d/K01ssh
    /etc/rc3.d/S17ssh
    /etc/rc5.d/S17ssh
    ```


# makefile
  * order 
    
    GNUmakefile, makefile and Makefile

    variable:MAKEFILES
      global makefiles,split by space, "target" in thoese files take no effect

  * global: *, ? , ~
    ~bob/ same as /home/bob

    objects = *.o # like macro in c
    objects = $(wildcard *.o)

    OBJS = $(SRCS:.c=.o)

  * ignore a makefile
      -include filename
  * add makefie
      include *.md 

  * vpath : search path for make
    1. vpath <pattern> <directories> : match files
    2. vpath <pattern> : clean match files
    3. vpath : clean all files
    ```makefile
    vpath %.c foo:foa
    vpath % blish
    vpath %.c bar
    ```
  * multiple targets
    ```makefile
    bigoutput littleoutput : text.g
      generate text.g -$(subst output,,$@) > $@

    # same as
    bigoutput : text.g
      generate text.g -big > bigoutput
    littleoutput : text.g
      generate text.g -little > littleoutput
    ```

  * static pattern
    ```makefile
    <targets ...> : <target-pattern> : <prereq-patterns ...>
      <commands>

    objects = foo.o bar.o
      all: $(objects)
    $(objects): %.o: %.c
      $(CC) -c $(CFLAGS) $< -o $@

    foo.o : foo.c
        $(CC) -c $(CFLAGS) foo.c -o foo.o
    bar.o : bar.c
        $(CC) -c $(CFLAGS) bar.c -o bar.o


    files = foo.elc bar.o lose.o
    $(filter %.o,$(files)): %.o: %.c
      $(CC) -c $(CFLAGS) $< -o $@
    $(filter %.elc,$(files)): %.elc: %.el
      emacs -f batch-byte-compile $<
    
    ```

    * display
      @echo 

      make -n/--just-print : only show command 
      make -s/--silent : supress all dispaly
    
    * execute: fork a shell to execute cmd
      write the command in one line if you want the later executed based on the fronter

      ```makefile
        exec:
          cd /home/;pwd # print /home
        
        extc:
          cd /home
          pwd
        # print the cwd
      ```

    * error handle
      -rm -f not-exits # ignore rm error
      make -i/--ignore-errors
      make -k/--keep-going :stop current target, go to next target

    * nesting
      ```makefile
      subsystem:
        cd subdir && $(MAKE)

      # same as
      subsystem:
        $(MAKE) -C subdir
    
    * export: pass value to sub makefile
    ```
      export variable := value

      variable = value
      export variable      

      export  # export all variables to sub makefiles
    ```

      __SHELL and MAKEFLAGS are always passed to sub Makfiles __

      -C , -f , -h, -o 和 -W/--print-directory
      when use -C , -w is auto enables unless use -s/--silent or --no-print-directory

    * package
      define run-yacc 
        yacc $(firstwork $^)
        mv y.tab.c $@
      endef

      foo.c : foo.y
        $(run-yacc)

      

  * $@ is the name of the target.
    ```makefile
    client: client.c
        $(CC) client.c -o $@

    server: server.c
        $(CC) server.c -o $@
    ```
  * $? macro stores the list of dependents more recent than the target 
  (i.e., those that have changed since the last time make was invoked for the given target)
    ```makefile
    client: client.c
        $(CC) $? -o $@

    server: server.c
        $(CC) $? -o $@
    ```
  * $^ gives you all dependencies, regardless of whether they are more recent than the target. 
      Duplicate names, however, will be removed. 
      This might be useful if you produce transient output 
      (such as displaying a result to the screen rather than saving it to a file). 
      ```makefile
      # print the source to the screen
      viewsource: client.c server.c
      less $^
      ```
  * $+ is like $^, but it keeps duplicates and gives you the entire list of dependencies in the order they appear.
    ```makefile
    # print the source to the screen
    viewsource: client.c server.c
            less $+
    ```

# kernel
  * [RCU](https://www.kernel.org/doc/Documentation/RCU/whatisRCU.txt)
    http://www2.rdrop.com/users/paulmck/RCU/ 
    The basic idea behind RCU is to split updates into "removal" and "reclamation" phases.
    Splitting the update into removal and reclamation phases permits the
    updater to perform the removal phase immediately, and to defer the
    reclamation phase until all readers active during the removal phase have
    completed, either by blocking until they finish or by registering a
    callback that is invoked after they finish.

      Holding a reference from one RCU read-side critical section
    to another is just as illegal as holding a reference from
    one lock-based critical section to another!  Similarly,
    using a reference outside of the critical section in which
    it was acquired is just as illegal as doing so with normal
    locking.

      The following diagram shows how each API communicates among the
reader, updater, and reclaimer.
      ```
	          rcu_assign_pointer()
	    			                        +--------+
            +---------------------->| reader |---------+
            |                       +--------+         |
            |                           |              |
            |                           |              | Protect:
            |                           |              | rcu_read_lock()
            |                           |              | rcu_read_unlock()
            |        rcu_dereference()  |              |
       +---------+                      |              |
       | updater |<---------------------+              |
       +---------+                                     V
            |                                    +-----------+
            +----------------------------------->| reclaimer |
                                                 +-----------+
              Defer:
              synchronize_rcu() & call_rcu()
       ```

       This section shows a simple use of the core RCU API to protect a
       global pointer to a dynamically allocated structure.  More-typical
       uses of RCU may be found in listRCU.txt, arrayRCU.txt, and NMI-RCU.txt.
       ```c
          struct foo {
            int a;
            char b;
            long c;
          };
          DEFINE_SPINLOCK(foo_mutex);

          struct foo __rcu *gbl_foo;

          /*
          * Create a new struct foo that is the same as the one currently
          * pointed to by gbl_foo, except that field "a" is replaced
          * with "new_a".  Points gbl_foo to the new structure, and
          * frees up the old structure after a grace period.
          *
          * Uses rcu_assign_pointer() to ensure that concurrent readers
          * see the initialized version of the new structure.
          *
          * Uses synchronize_rcu() to ensure that any readers that might
          * have references to the old structure complete before freeing
          * the old structure.
          */
          void foo_update_a(int new_a)
          {
            struct foo *new_fp;
            struct foo *old_fp;

            new_fp = kmalloc(sizeof(*new_fp), GFP_KERNEL);
            spin_lock(&foo_mutex);
            old_fp = rcu_dereference_protected(gbl_foo, lockdep_is_held(&foo_mutex));
            *new_fp = *old_fp;
            new_fp->a = new_a;
            rcu_assign_pointer(gbl_foo, new_fp);
            spin_unlock(&foo_mutex);
            synchronize_rcu();
            kfree(old_fp);
          }

          /*
          * Return the value of field "a" of the current gbl_foo
          * structure.  Use rcu_read_lock() and rcu_read_unlock()
          * to ensure that the structure does not get deleted out
          * from under us, and use rcu_dereference() to ensure that
          * we see the initialized version of the structure (important
          * for DEC Alpha and for people reading the code).
          */
          int foo_get_a(void)
          {
            int retval;

            rcu_read_lock();
            retval = rcu_dereference(gbl_foo)->a;
            rcu_read_unlock();
            return retval;
          }
       ```
       So, to sum up:
        
       * Use rcu_read_lock() and rcu_read_unlock() to guard RCU
          read-side critical sections.

       * Within an RCU read-side critical section, use rcu_dereference()
          to dereference RCU-protected pointers.

       *	Use some solid scheme (such as locks or semaphores) to
          keep concurrent updates from interfering with each other.

       * Use rcu_assign_pointer() to update an RCU-protected pointer.
          This primitive protects concurrent readers from the updater,
          -not- concurrent updates from each other!  You therefore still
          need to use locking (or something similar) to keep concurrent
          rcu_assign_pointer() primitives from interfering with each other.

       *  Use synchronize_rcu() -after- removing a data element from an
          RCU-protected data structure, but -before- reclaiming/freeing
          the data element, in order to wait for the completion of all
          RCU read-side critical sections that might be referencing that
          data item.


  * intall
    * [download tar.gz](https://www.kernel.org/pub/linux/kernel/) 

    * uncompress
      tar -jzxv linux-2.6.34.tar.bz2

    * make defconfig 

    * make oldconfig

    * make -j2

    * make modules_install

    * cp bzImage to root
      ```bash
      cp arch/x86_64/boot/bzImage  /boot/vmlinuz-2.6.34.el6.x86_64
      chmod +x /boot/vmlinuz-2.6.34.el6.x86_64
      ```
    * cp system.map
      ```bash
      cp System.map /boot/System.map-2.6.34.el6.x86_64
      ```

    * mkinitrd /boot/initramfs-2.6.34.el6.x86_64.img 2.6.34

    * grub
      ```bash
      cp /boot/grub/grub.conf /boot/grub/grub.conf.bak
      title CentOS (2.6.34.el6.x86_64)
        root (hd0,0)
        kernel /vmlinuz-2.6.34.el6.x86_64 ro root=/dev/mapper/VolGroup-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap SYSFONT=latarcyrheb-sun16 crashkernel=auto rd_LVM_LV=VolGroup/lv_root  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet
        initrd /initramfs-2.6.34.el6.x86_64.img
      ```

    * initrd:
      he kernel then can use /dev/initrd’s contents for a two-phase system boot-up
      1. boot-up  phase:the kernel starts up and mounts an initial root file-system from the contents of
       /dev/initrd (e.g., RAM disk initialized by the boot loader)
      
      2. additional drivers  or  other modules  are  loaded  from the initial root device’s contents.
      gunzip initramfs.img.gz
      mkdir initramfs
      cd initramfs
      cpio -idv < ../initramfs.img

      find . | cpio --create --format='newc' > /tmp/newinitrd
      gzip newinitrd 
  
  * gdb
    gdb --args bochs-bin -q -f bochsrc

  
      
* service configuration
  * dns server configuration bind
   
    1. records
      * SOA record
        start of authority, Indicates authority for this zone
      * NS record
        Lists a nameserver for this zone
      * Other records
        Data about hosts in this zone Of the other records, this chapter covers:
      * A
        Name-to-address mapping
      * PTR
        Address-to-name mapping
      * CNAME
        Canonical name (for aliases)
        
    2. types
        name    | description
        --      | -----------
        TYPE    |        value and meaning
        A       |        1 a host address
        NS      |        2 an authoritative name server
        MD      |        3 a mail destination (Obsolete - use MX)
        MF      |        4 a mail forwarder (Obsolete - use MX)
        CNAME   |        5 the canonical name for an alias
        SOA     |        6 marks the start of a zone of authority
        MB      |        7 a mailbox domain name (EXPERIMENTAL)
        MG      |        8 a mail group member (EXPERIMENTAL)
        MR      |        9 a mail rename domain name (EXPERIMENTAL)
        NULL    |        10 a null RR (EXPERIMENTAL)
        WKS     |        11 a well known service description
        PTR     |        12 a domain name pointer
        HINFO   |        13 host information
        MINFO   |        14 mailbox or mail list information
        MX      |        15 mail exchange
        TXT     |        16 text strings

    3. QTYPE values:QTYPE fields appear in the question part of a query.  QTYPES are a superset of TYPEs, hence all TYPEs are valid QTYPEs.
      name      |     description
      ----      | ------------
      AXFR      |      252 A request for a transfer of an entire zone
      MAILB     |      253 A request for mailbox-related records (MB, MG or MR)
      MAILA     |      254 A request for mail agent RRs (Obsolete - see MX)
      *         |      255 A request for all records

    4. CLASS values:CLASS fields appear in resource records.  The following CLASS mnemonics and values are defined:
      name    | description 
      ----    | ----------
      IN      |    1 the Internet
      CS      |    2 the CSNET class (Obsolete - used only for examples in some obsolete RFCs)
      CH      |    3 the CHAOS class
      HS      |    4 Hesiod [Dyer 87]

    5. QCLASS values:QCLASS fields appear in the question section of a query.  QCLASS values are a superset of CLASS values; 
      every CLASS is a valid QCLASS.  In addition to CLASS values, the following QCLASSes are defined: 
      name    | description
      ---     | -----------
      *       |  255 any class

    6. syntax
      1. comment: ;
      2. directives: $  $ttl, $origin
      3. resource record(RR): 
      4. field seperater: table or space

    7. sample
      ```
      ; IPv4 zone file for example.com
      $TTL 2d ; default TTL for zone
      $ORIGIN example.com. ; base domain-name
      ; Start of Authority record defining the key characteristics
      ; of the zone (domain)
      @ IN SOA ns1.example.com. hostmaster.example.com. (
              2003080800 ; se = serial number
              12h ; ref = refresh
              15m ; ret = refresh retry
              3w ; ex = expiry
              2h ; nx = nxdomain ttl
              )
      ; name servers Resource Records for the domain
      IN NS ns1.example.com.
      ; the second name server is
      ; external to this zone (domain).
      IN NS ns2.example.net.
      ; mail server Resource Records for the zone (domain)
      ; value 10 denotes it is the most preferred
      3w  IN  MX  10 mail.example.com.
      ; the second mail server has lower preference (20) and is
      ; external to the zone (domain)
          IN  MX  20 mail.example.net.
      ; domain hosts includes NS and MX records defined previously
      ; plus any others required
      ns1     IN   A     192.168.254.2
      mail    IN   A     192.168.254.4
      joe     IN   A     192.168.254.6
      www     IN   A     192.168.254.7
      ; aliases ftp (ftp server) to an external location
      ftp IN CNAME ftp.example.net.
      ```
      * $TTL directive: time to live for a zone or domain, which is the time a RR may be cached by another server, mandatory
        * access load: lower TTL means more frequent dns queries to occur.
        * change propagate: TTL represents max time that a propagate will take from the zone name server to users.

      * $ORIGIN directive: the domain name for the zone defined, optional
        * defines the domain name that will be appended to any incomplete name (sometimes called an unqualified name) defined in an RR
        * The $ORIGIN Substitution Rule If a name appears in a RR and does not end with a dot, then the value of the last or only $ORIGIN 
          directive will be appended to the name. If the name ends with a dot, then it is a fully qualified domain name (FQDN) and nothing will be appended
      * A start of authority(SOA) RR: must be first RR in a zone file, descript the feathures of zone or domain, only one, mondatory
        * SOA RR syntax:
          @   IN  ns1.example.com   hostmaster.example.com (
              2003080800 ; se = serial number
              12h ; ref = refresh
              15m ; ret = refresh retry
              3w ; ex = expiry
              2h ; nx = nxdomain ttl
          )
          syntax         |          name           | description
          ------         | ---- | -----------
           name          |   @  | substitutes the current value of $ORIGIN (in the example file this is example.com.).
           ttl           |      |  There is no ttl value defined for the RR, so the zone default of 2d (172800 seconds) from the $TTL directive will be used.
           class         | IN   |  IN defines the class to be Internet (defaulted if omitted). Other values exist but are rarely used. 
           name-server   | ns1.example.com. | Defines the Primary Master name server for the zone, MNAME
           email         | hostmaster.example.com. |  Defines an administrative e-mail address for the zone. mail will be sent to hostmaster@example.com. RNAME 
           sn            | 2003080800 | must be updated each time changes made to the domain, by convention yyyymmddss
           refresh       | 12h        | when time reached, slave name server for this zone will try to read the SOA RR from the zone, 3-24h
           retry         | 15m        | retry interval when slave fails to contact with master, 10-60mh
           expire        | 3w         | If the slave failed to contact when expiry reached, the slave will stop responding to any queries. The zone is dead.
           nx            | 3h         | rfc 2308, the period of time that negative responses can be cached by a resolver. 0-10800(3 hours)

           email sn refresh refresh expire nxdomain ttl

      * name server(NS) RR: define NS that are authority for the zone or domain, >= 2, NS RR may refercens servers on same domain, or in a foreign or external
        domain, mandotory.
        * zone        ttl   class rr name-server
          movie.edu           IN  NS toystory.movie.edu.
          movie.edu.          IN  NS wormhole.movie.edu.
          These records indicate that there are two nameservers for the zone movie.edu. 

      * Mail Exchanger(MX) RR: Define mail servers for the zone, >= 0, on the same domain or external domain, optional.
        * name ttl class  rr preference     name
                3w  IN    MX    10        mail.example.com

      * Address(A) RR: define IPv4 address of all hosts or services, publicity visible, AAAA(call Quad A) RR for IPv6,  >=0, optional
        * name ttl class rr ipv4

      * Conanical Name(CNAME) RR: alias for another host, >=0, optional
        * name ttl class rr canonical-name

      * PTR RR: reverse-mapping, address to hostname
        * address     ttl           class type      hostname
        1.249.249.192.in-addr.arpa.   IN   PTR   wormhole.movie.edu.
        2.249.249.192.in-addr.arpa.   IN   PTR   shrek.movie.edu.
        3.249.249.192.in-addr.arpa.   IN   PTR   toystory.movie.edu.
        4.249.249.192.in-addr.arpa.   IN   PTR   monsters-inc.movie.edu.
      
      * full example:
        ```
        db.movie.edu:
        $TTL 3h
        movie.edu. IN SOA toystory.movie.edu. al.movie.edu. (
              81
              811 ; Serial
              3h ; Refresh after 3 hours
              1h ; Retry after 1 hour
              1w ; Expire after 1 week
              1h ) ; Negative caching TTL of 1 hour
        ;
        ; Name servers
        ;
        movie.edu. IN NS toystory.movie.edu.
        movie.edu. IN NS wormhole.movie.edu.
        ;
        ; Addresses for the canonical names
        ;
        localhost.movie.edu.    IN A 127.0.0.1
        shrek.movie.edu.        IN A 192.249.249.2
        toystory.movie.edu.     IN A 192.249.249.3
        monsters-inc.movie.edu. IN A 192.249.249.4
        misery.movie.edu.       IN A 192.253.253.2
        shining.movie.edu.      IN A 192.253.253.3
        carrie.movie.edu.       IN A 192.253.253.4
        wormhole.movie.edu.     IN A 192.249.249.1
        wormhole.movie.edu.     IN A 192.253.253.1
        ;
        ; Aliases
        ;
        toys.movie.edu. IN CNAME toystory.movie.edu.
        mi.movie.edu.   IN CNAME monsters-inc.movie.edu.
        wh.movie.edu.   IN CNAME wormhole.movie.edu.
        ;
        ; Interface specific names
        ;
        wh249.movie.edu. IN A 192.249.249.1
        wh253.movie.edu. IN A 192.253.253.1

        db.192.249.249:
        $TTL 3h
        249.249.192.in-addr.arpa. IN SOA toystory.movie.edu. al.movie.edu.(
              1 ; Serial
              3h ; Refresh after 3 hours
              1h ; Retry after 1 hour
              1w ; Expire after 1 week
              1h ) ; Negative caching TTL of 1 hour
              ;
        ; Name servers
        ;
        249.249.192.in-addr.arpa. IN NS toystory.movie.edu.
        249.249.192.in-addr.arpa. IN NS wormhole.movie.edu.
        ;
        ; Addresses point to canonical name
        ;
        1.249.249.192.in-addr.arpa. IN PTR wormhole.movie.edu.
        2.249.249.192.in-addr.arpa. IN PTR shrek.movie.edu.
        3.249.249.192.in-addr.arpa. IN PTR toystory.movie.edu.
        4.249.249.192.in-addr.arpa. IN PTR monsters-inc.movie.edu.

        b.127.0.0:
        $TTL 3h
        0.0.127.in-addr.arpa. IN SOA toystory.movie.edu. al.movie.edu. (
                1 ; Serial
                3h ; Refresh after 3 hours
                1h ; Retry after 1 hour
                1w ; Expire after 1 week
                1h  ; Negative caching TTL of 1 hour
             )
        0.0.127.in-addr.arpa. IN NS toystory.movie.edu.
        0.0.127.in-addr.arpa. IN NS wormhole.movie.edu.
        1.0.0.127.in-addr.arpa. IN PTR localhost.
        ```

      * my configuration
        * install [bind] 
          ```
          https://www.ietf.org/rfc/rfc1035.txt
          http://cymru.com/Documents/secure-bind-template.html
          yum install bind bind-utils bind-chroot -y
          ```
        * namde conf
          ```
          cat /etc/named.conf
          //
          // named.conf
          //
          // Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
          // server as a caching only nameserver (as a localhost DNS resolver only).
          //
          // See /usr/share/doc/bind*/sample/ for example named configuration files.
          //

          acl deny-net {
              0.0.0.0/8;
              192.0.2.0/24;
              224.0.0.0/3;
              10.0.0.0/8;
              172.16.0.0/12;
          };

          acl allow-net {
              192.168.2.0/24;
          };

          acl axfr {
              192.168.2.135;
          };

          options {
            listen-on port 53 { 192.168.2.131; };
            listen-on-v6 port 53 { ::1; };
            directory 	"/var/named";
            dump-file 	"/var/named/data/cache_dump.db";
                  statistics-file "/var/named/data/named_stats.txt";
                  memstatistics-file "/var/named/data/named_mem_stats.txt";

            allow-query     { allow-net; };
              allow-query-cache { allow-net; };
              allow-recursion { allow-net; };
              allow-transfer  {
                  axfr;
              };
              // recursion yes;
              blackhole   {deny-net; };

              // Prevent DoS attacks by generating bogus zone transfer
              // requests.  This will result in slower updates to the
              // slave servers (e.g. they will await the poll interval
              // before checking for updates).
              notify no;

              // Generate more efficient zone transfers.  This will place
              // multiple DNS records in a DNS message, instead of one per
              // DNS message.
              transfer-format many-answers;

              // Set the maximum zone transfer time to something more
              // reasonable.  In this case, we state that any zone transfer
              // that takes longer than 60 minutes is unlikely to ever
              // complete.  WARNING:  If you have very large zone files,
              // adjust this to fit your requirements. 
              max-transfer-time-in 60;

              // We have no dynamic interfaces, so BIND shouldn't need to
              // poll for interface state {UP|DOWN}.
              interface-interval 0;

            dnssec-enable yes;
            dnssec-validation yes;

            /* Path to ISC DLV key */
            bindkeys-file "/etc/named.iscdlv.key";

            managed-keys-directory "/var/named/dynamic";
          };

          logging {
                  channel default_debug {
                          file "data/named.run";
                          severity dynamic;
                  };

                  channel audit_log {
                      file "data/name.log";
                      severity debug;
                      print-time yes;
                  };

                  category default { default_debug;};
                  category general { default_debug; };
                  category security { audit_log; default_debug; };
                  category config { default_debug; };
                  category resolver { audit_log; };
                  category xfer-in { audit_log; };
                  category xfer-out { audit_log; };
                  category notify { audit_log; };
                  category client { audit_log; };
                  category network { audit_log; };
                  category update { audit_log; };
                  category queries { audit_log; };
                  category lame-servers { audit_log; };
          };


          view "internal-in" IN {
              match-clients {allow-net;};

              // recursion yes;
              additional-from-auth yes;
              additional-from-cache yes;

              zone "." IN {
                  type hint;
                  file "named.ca";
              };

              include "/etc/named.rfc1912.zones";

              zone "dob.com" IN {            
                  type master;
                  file "dob.com.db";
                  allow-update { none; };
                  allow-query { allow-net; };
              };
          };


          view "external-in" in {
              match-clients { any; };
              // recursion no;
              additional-from-auth no;
              additional-from-cache no;

              zone "." in {
                  type hint;
                  file "named.ca";
              };

              include "/etc/named.rfc1912.zones";
          };

          view "external-chaos" chaos {
              match-clients {any;};
              recursion no;

              zone "." {
                  type hint;
                  file "/dev/null";
              };

              zone "bind" {
                  type master;
                  file "db.bind";

                  allow-query {
                      allow-net;
                  };

                  allow-transfer {
                      none;
                  };
              };
          };


          include "/etc/named.root.key";

          ```
        
        * dob.com.bd
          ```
          cat `pwd`/dob.com.db
          ; IPv4 zone file for dob.com
          $TTL 2d ; default TTL for zone
          $ORIGIN dob.com.
          ; Start of Authority record defining the key characteristics of the zone (domain)
          @ IN SOA ns1.dob.com. centos.dob.com. (
                  2003080800 ; sn = serial number
                  12h ; refresh
                  15m ; retry = refresh retry
                  3w ; expiry
                  2h ; nx = nxdomain ttl
                  )
          ; name servers Resource Records for the domain
              IN NS ns1.dob.com.
          ; the second name servers is
          ; external to this zone (domain).
          ;    IN NS ns2.dob.net.
          ; mail server Resource Records for the zone (domain)
          3w IN MX 10 mail.dob.com.
          ; the second mail servers is
          ; external to the zone (domain)
          ; IN MX 20 mail.anotherdomain.com.
          ; domain hosts includes NS and MX records defined above
          ; plus any others required
          ns1     IN  A 192.168.2.131
          mail    IN  A 192.168.2.131
          www     IN  A 192.168.2.131
          centos    IN  CNAME ns1.dob.com.
          ```

          db.bind
          ```
          cat db.bind
          ;@(#) db.bind v1.2 25 JAN 2001 Team Cymru Thomas noc@cymru.com
          ;
          $TTL 1D
          $ORIGIN bind.
          @   1D  CH   SOA localhost. root.localhost. (
                  2017021217  ; serial number
                  3h  ; refresh
                  1h  ; retry
                  1w  ; expire
                  1d  ; nxmain
                  )
              CH   NS  localhost.

          version CH   TXT "BIND 9"
          authors CH   TXT "LA LA LA LA. :)"
          ```

        * start service and configure autostart
          ```bash
          service named restart
          chkconfig named on

          iptables -t filter -I INPUT -p tcp -s 192.168.0.0/16 --dport 53 -j ACCEPT
          iptables -t filter -I INPUT -p udp -s 192.168.0.0/16 --dport 53 -j ACCEPT
          service iptalbes save
          ```
        
        * test 
          ```bash
          dig @192.168.2.131  ns1.dob.com -t any

          dig @192.168.2.131 dob.com axfr
            ; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6_8.4 <<>> @192.168.2.131 dob.com axfr
            ; (1 server found)
            ;; global options: +cmd
            dob.com.		172800	IN	SOA	ns1.dob.com. centos.dob.com. 2003080800 43200 900 1814400 7200
            dob.com.		172800	IN	NS	ns1.dob.com.
            dob.com.		1814400	IN	MX	10 mail.dob.com.
            centos.dob.com.		172800	IN	CNAME	ns1.dob.com.
            mail.dob.com.		172800	IN	A	192.168.2.131
            ns1.dob.com.		172800	IN	A	192.168.2.131
            www.dob.com.		172800	IN	A	192.168.2.131
            dob.com.		172800	IN	SOA	ns1.dob.com. centos.dob.com. 2003080800 43200 900 1814400 7200
            ;; Query time: 1 msec
            ;; SERVER: 192.168.2.131#53(192.168.2.131)
            ;; WHEN: Sun Feb 12 02:35:04 2017
            ;; XFR size: 8 records (messages 1, bytes 209)
          ```
  * dpkg
    * dpkg --force-all --purge texlive-base
      dpkg --purge snmpcheck
      dpkg --install 
      apt-get upgrade -s -f

      apt-get -f update
    
    * dpkg error:
      ```
      * apt-get update
        .......
        dpkg: dependency problems prevent processing triggers for man-db:
        man-db depends on bsdmainutils; however:
          Package bsdmainutils is not configured yet.

        dpkg: error processing archive /var/cache/apt/archives/libpam-modules_1.1.8-3.5_amd64.deb (--unpack):
        dependency problems - leaving triggers unprocessed
        Errors were encountered while processing:
        /var/cache/apt/archives/libpam-modules_1.1.8-3.5_amd64.deb
        E: Sub-process /usr/bin/dpkg returned an error code (1)

      * apt-get install bsdmainutils
        Reading package lists... Done
        Building dependency tree       
        Reading state information... Done
        bsdmainutils is already the newest version.
        You might want to run 'apt-get -f install' to correct these:
        The following packages have unmet dependencies:
        libpam-modules : PreDepends: libpam-modules-bin (= 1.1.3-7.1) but 1.1.8-3.5 is to be installed
        E: Unmet dependencies. Try 'apt-get -f install' with no packages (or specify a solution).

      * dpkg --force-downgrade --install libpam-modules-bin-1.1.3-7.1

      * apt-cache showpkg libpam-modules-bin
        Package: libpam-modules-bin
        Versions: 
        1.1.8-3.5 (/var/lib/apt/lists/http.kali.org_kali_dists_kali-rolling_main_binary-amd64_Packages)
        Description Language: 
                        File: /var/lib/apt/lists/http.kali.org_kali_dists_kali-rolling_main_binary-amd64_Packages
                          MD5: 25d278fc7450d5202a9a137f71302e58


        Reverse Depends: 
          libpam-modules,libpam-modules-bin 1.1.3-7.1
          libpam-modules,libpam-modules-bin 1.1.8-3.5
        Dependencies: 
        1.1.8-3.5 - libaudit1 (2 1:2.2.1) libc6 (2 2.14) libpam0g (2 0.99.7.1) libselinux1 (2 1.32) libpam-modules (3 1.1.3-8) 
        Provides: 
        1.1.8-3.5 - 
        Reverse Provides: 

      * apt-cache policy libpam-modules-bin
        libpam-modules-bin:
        Installed: (none)
        Candidate: 1.1.8-3.5
        Version table:
          1.1.8-3.5 0
              500 http://http.kali.org/kali/ kali-rolling/main amd64 Packages
        
        apt-get install libpam-modules-bin=1.1.3-7.1
      ```

  * network connection error
    * eth0 eth1
      * ifconfig eth1 down
        ifconfig eth0 down
      * ifconfig eth0 up
      
      * tcpdump -i any -vvv &> /tmp/tcpdump.log
        dhclient -4 -p 68 -s 255.255.255.255 -d -v 

        strace -f -e verbose=a trace=process,file -s 128 ifup eth1
        /sbin/dhclient [/sbin/dhclient -4 -v -pf /run/dhclient.eth1.pid -lf /var/lib/dhcp/dhclient.eth1.leases -I -df /var/lib/dhcp/dhclient6.eth1.leases eth1]

      * dpkg -S /sbin/dhclient
        isc-dhcp-client: /sbin/dhclient
        
  * tftp server configure
    * yum install xinetd tftp tftp-server -y
    
    * configure tftp:
      ```
      cat /etc/xinetd.d/tftp 
      # default: off
      # description: The tftp server serves files using the trivial file transfer \
      #	protocol.  The tftp protocol is often used to boot diskless \
      #	workstations, download configuration files to network-aware printers, \
      #	and to start the installation process for some operating systems.
      service tftp
      {
        socket_type		= dgram
        protocol		  = udp
        port          = 69
        wait			    = yes
        user			    = root
        server			  = /usr/sbin/in.tftpd
        server_args		= -s /var/lib/tftpboot # root directory 
        disable			  = yes
        per_source		= 11
        cps			      = 100 2
        flags			    = IPv4
      }
      ```
    
    * service xinetd restart
      iptables -t filter -I INPUT -p udp -s 192.168.0.0/16 --dport 69 -j ACCEPT
    
    * tftp:
      ```bash
      tftp 192.168.2.131
      tftp> verbose
      Verbose mode on.
      tftp> trace
      Packet tracing on.
      tftp> get test
      getting from 192.168.2.131:test to test [netascii]
      sent RRQ <file=test, mode=netascii>
      received DATA <block=1, 0 bytes>
      tftp> get /etc/passwd /tmp/passwd.copy
      getting from 192.168.2.131:/etc/passwd to /tmp/passwd.copy [netascii]
      sent RRQ <file=/etc/passwd, mode=netascii>
      received ERROR <code=1, msg=File not found>
      Error code 1: File not found
      ```
    
  - [tcp wrappers](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/sect-Security_Guide-TCP_Wrappers_and_xinetd-TCP_Wrappers_Configuration_Files.html):
    - configure:<daemon list> : <client list> [: <option> : <option> : …]
       ```
        sshd : .example.com  \
        : spawn /bin/echo `/bin/date` access denied>>/var/log/sshd.log \
        : deny
       ```
      - daemon list> — A comma-separated list of process names (not service names) or the ALL wildcard.
      - client list> — A comma-separated list of hostnames, host IP addresses, special patterns, or wildcards which identify the hosts affected by the rule.
      - option> — An optional action or colon-separated list of actions performed when the rule is triggered. 
        1. Wildcards:
           - ALL — Matches everything. It can be used for both the daemon list and the client list.
           - LOCAL — Matches any host that does not contain a period (.), such as localhost.
           - KNOWN — Matches any host where the hostname and host address are known or where the user is known.
           - UNKNOWN — Matches any host where the hostname or host address are unknown or where the user is unknown.
           - PARANOID — A reverse DNS lookup is done on the source IP address to obtain the host name. Then a DNS lookup is performed to resolve the IP address.
             If the two IP addresses do not match the connection is dropped and the logs are updated 
        2. patterns: 
          ```
          1.  beginning with a period (.) 
            ALL : .example.com
          2. ending with a period (.) 
            ALL : 192.168.
          3. IP address/netmask pair
            ALL : 192.168.0.0/255.255.254.0
          4. [IPv6 address]/prefixlen pair — [net]/prefixlen pairs
            ALL : [3ffe:505:2:1::]/64
          5. he asterisk (*) 
            ALL : *.example.com
          6. The slash (/) 
            in.telnetd : /etc/telnet.hosts
          ```
        3. expansions:
          - %a — Returns the client's IP address.
          - %A — Returns the server's IP address.
          - %c — Returns a variety of client information, such as the user name and hostname, or the user name and IP address.
          - %d — Returns the daemon process name.
          - %h — Returns the client's hostname (or IP address, if the hostname is unavailable).
          - %H — Returns the server's hostname (or IP address, if the hostname is unavailable).
          - %n — Returns the client's hostname. If unavailable, unknown is printed. If the client's hostname and host address do not match, paranoid is printed.
          - %N — Returns the server's hostname. If unavailable, unknown is printed. If the server's hostname and host address do not match, paranoid is printed.
          - %p — Returns the daemon's process ID.
          - %s —Returns various types of server information, such as the daemon process and the host or IP address of the server.
          - %u — Returns the client's user name. If unavailable, unknown is printed. 
      - step: take effect immediately when files changes
        1. /etc/hosts.allow
          ```
          in.tftpd: LOCAL
          ```
        2. /etc/host.deny
          ```
          in.tftpd: ALL: spawn (/usr/sbin/safe_finger -l @%h | \
                       /usr/ucb/mail -s %d-%h root) &
          ```
  - snmp 
    ```
    service snmpd start
    iptables -t filter -I INPUT -p udp -s 192.168.0.0/16 --dport 161 -j ACCEPT
    service iptables save

    snmpcmd:
      # community:public snmp-version 1, 2c, 3
      snmpwalk -c public -v 2c 192.168.2.131
        iso.3.6.1.2.1.1.1.0 = STRING: "Linux centos.dob.com 2.6.32-642.11.1.el6.x86_64 #1 SMP Fri Nov 18 19:25:05 UTC 2016 x86_64"
        iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10
        iso.3.6.1.2.1.1.3.0 = Timeticks: (228904) 0:38:09.04
        iso.3.6.1.2.1.1.4.0 = STRING: "Root <root@localhost> (configure /etc/snmp/snmp.local.conf)"
        iso.3.6.1.2.1.1.5.0 = STRING: "centos.dob.com"
        iso.3.6.1.2.1.1.6.0 = STRING: "Unknown (edit /etc/snmp/snmpd.conf)"
        iso.3.6.1.2.1.1.8.0 = Timeticks: (67) 0:00:00.67
        iso.3.6.1.2.1.1.9.1.2.8 = OID: iso.3.6.1.6.3.16.2.2.1
        iso.3.6.1.2.1.1.9.1.3.1 = STRING: "The MIB for Message Processing and Dispatching."
        iso.3.6.1.2.1.1.9.1.3.2 = STRING: "The MIB for Message Processing and Dispatching."
        iso.3.6.1.2.1.1.9.1.3.3 = STRING: "The SNMP Management Architecture MIB."
        iso.3.6.1.2.1.1.9.1.3.4 = STRING: "The MIB module for SNMPv2 entities"
        iso.3.6.1.2.1.1.9.1.3.5 = STRING: "The MIB module for managing TCP implementations"
        iso.3.6.1.2.1.1.9.1.3.6 = STRING: "The MIB module for managing IP and ICMP implementations"
        iso.3.6.1.2.1.1.9.1.3.7 = STRING: "The MIB module for managing UDP implementations"
        iso.3.6.1.2.1.1.9.1.3.8 = STRING: "View-based Access Control Model for SNMP."
        iso.3.6.1.2.1.25.1.1.0 = Timeticks: (955530) 2:39:15.30
        End of MIB
     ```

# vpn server 
  1. install packages 
    ```
    yum install wget bind-utils
    ```

  2. install epel repository for xl2tpd package
    ```
    yum install openswan xl2tpd ppp lsof
    ```

  3. firewall and sysctl
    ```bash
    iptables -t nat -A POSTROUTING -j MASQUERADE

    enable kernel IP packet forwarding and disable ICP redirects.

    echo "net.ipv4.ip_forward = 1" |  tee -a /etc/sysctl.conf
    echo "net.ipv4.conf.all.accept_redirects = 0" |  tee -a /etc/sysctl.conf
    echo "net.ipv4.conf.all.send_redirects = 0" |  tee -a /etc/sysctl.conf
    for vpn in /proc/sys/net/ipv4/conf/*; do echo 0 > $vpn/accept_redirects; echo 0 > $vpn/send_redirects; done
    sysctl -p


     pfs: whether Perfect Forward Secrecy of keys is desired on the connection´s keying channel (with PFS, penetration
           of the key-exchange protocol does not compromise keys negotiated earlier); Since there is no reason to ever
           refuse PFS, Libreswan will allow a connection defined with pfs=no to use PFS anyway. Acceptable values a

    The Federal Information Processing Standard (FIPS)

    # multiport dports isakmp,l2tp,ipsec-nat-t
    Different standard protocols exist for constructing VPNs. The best known for IP type VPNs is definitely IPSEC where for each single packet 
    the header is authenticated by the AH protocol and the payload encrypted by the ESP protocol. However, the fact of encrypting the payload, 
    also containing the source and destination port number of the TCP/UDP transmission level, creates problems for intermediate routers effecting NAT. 
    These latter, furthermore, generate checksum errors for the AH authentication protocol by changing the packet source IP. The solution, 
    known as NAT Traversal (NAT-T), is generally to encapsulate IPSEC into UDP datagrams on port 4500. Another problem of IPSEC is that in order
     to be able to authenticate and encrypt the packets a key exchange structure called IKE (Internet Key Exchange) is required. This server,
    which replies on the UDP 500 port, generally supports authentication with preshared keys or with X.509 certificates. 
    iptables -t filter -I INPUT -p udp -m multiport --dports 500,1701,4500 -j ACCEPT   
    iptables -t filter 

    ipsec secrets
    ipsec auto --rereadsecrets

    ipsec showhostkey --left
    ipsec showhostkey loading secrets from "/etc/ipsec.secrets"
    ipsec showhostkey loading secrets from "/etc/ipsec.d/dob.secrets"
    ipsec showhostkey: wrong kind of key PPK_PSK in show_confkey. Expected PPK_RSA.

    ipsec whack --listall
    000  
    000 List of RSA Public Keys:
    000  
    000  
    000 List of Pre-shared secrets (from /etc/ipsec.secrets)
    000  
    000     1: PSK %any 192.168.2.131
    000     1: RSA (none) (none)
    000  
    000 List of X.509 End Certificates:
    000  
    000 List of X.509 CA Certificates:
    000  
    000 List of CRLs:


    aptitude -r install network-manager-openvpn-gnome network-manager-pptp network-manager-pptp-gnome network-manager-strongswan network-manager-vpnc network-manager-vpnc-gnome

    http://rootmanager.com/ubuntu-ipsec-l2tp-windows-domain-auth/setting-up-openswan-xl2tpd-with-native-windows-clients-lucid.html

    # ipsec and ike
    https://libreswan.org/wiki/

    https://wiki.strongswan.org/projects/strongswan/wiki/IpsecStandards

    https://support.microsoft.com/en-us/help/926179/how-to-configure-an-l2tp-ipsec-server-behind-a-nat-t-device-in-windows-vista-and-in-windows-server-2008
    enable ipsec nat-t:
    1.Locate and then click the following registry subkey:
      ```
      HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\PolicyAgent
      ```
      Note You can also apply the AssumeUDPEncapsulationContextOnSendRule DWORD value to a Microsoft Windows XP Service Pack 2 (SP2)-based VPN client computer. To do this, locate and then click the following registry subkey:
      ```
      HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\IPSec
      ```
    2. On the Edit menu, point to New, and then click DWORD (32-bit) Value.
      Type AssumeUDPEncapsulationContextOnSendRule, and then press ENTER.
      Right-click AssumeUDPEncapsulationContextOnSendRule, and then click Modify.
      In the Value Data box, type one of the following values:
        - 0: A value of 0 (zero) configures Windows so that it cannot establish security associations with servers that are located behind NAT devices. 
            This is the default value.
        - 1: A value of 1 configures Windows so that it can establish security associations with servers that are located behind NAT devices.
        - 2: A value of 2 configures Windows so that it can establish security associations when both the server and the Windows Vista-based or 
            Windows Server 2008-based VPN client computer are behind NAT devices.

    3. Click OK, and then exit Registry Editor.
    4. Restart the computer.

    ipsec newhostkey 

    chkconfig --level 2345 ipsec on
    chkconfig --level 2345 xl2tpd on

    openssl rand -base64 48

    ipsec setup start
    ipsec auto --add L2TP-PSK-noNAT
    ipsec auto --add L2TP-PSK-NAT
    ipsec auto --up L2TP-PSK # failed
    ipsec auto --rereadsecrets

# configure vpn client in ubuntu
  - add source list
    ```
    vim /etc/apt/sources.list.d/openswan-srv.list
    #deb openswan
    deb-src http://ftp.debian.org/debian/ sid main

    W: GPG error: http://ftp.debian.org sid InRelease: The following signatures couldn't be verified because the public key is not available: 
    NO_PUBKEY 8B48AD6246925553 NO_PUBKEY 7638D0442B90D010
    apt-key adv --keyserver keyserver.ubuntu.com --recv-key 8B48AD6246925553
    apt-key adv --keyserver keyserver.ubuntu.com --recv-key 7638D0442B90D010
    ```

    

# [make a virtual ethernet device in linux](http://unix.stackexchange.com/questions/152331/how-can-i-create-a-virtual-ethernet-interface-on-a-machine-without-a-physical-ad)
  - create device
    ```
    1. add kernel module
      lsmod | grep dummy
      modprobe dummy
      lsmode | grep dummy
      dummy                   2682  0

    2. show now link
       ip link show
       1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN 
           link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
       2: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
           link/ether 00:0c:29:bb:4f:c9 brd ff:ff:ff:ff:ff:ff
       3: virbr0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN 
           link/ether 52:54:00:56:79:3a brd ff:ff:ff:ff:ff:ff
       4: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN qlen 500
           link/ether 52:54:00:56:79:3a brd ff:ff:ff:ff:ff:ff
       6: dummy0: <BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN 
          link/ether 96:0f:40:70:c2:d4 brd ff:ff:ff:ff:ff:ff
    
    3. set new name
       ip link set dummy0 name eth0
       ip link show dummy0
       eth0: <BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN 
       link/ether 96:0f:40:70:c2:d4 brd ff:ff:ff:ff:ff:ff

  - change MAC 
    ```
     ifconfig eth0 hw ether 00:0C:29:76:6B:B8
     ip addr add 192.168.16.31/24 brd + dev eth0

     ip addr show eth0
      6: eth0: <BROADCAST,NOARP> mtu 1500 qdisc noop state DOWN 
          link/ether 00:0c:29:76:6b:b8 brd ff:ff:ff:ff:ff:ff
          inet 192.168.16.31/24 brd 192.168.16.255 scope global eth0
     ```

  - remove all above
    ```
    ip addr del 192.168.16.31/24 brd + dev eth0
    ip link del eth0 type dummy
    rmmod dummy
    ```


  - link-local range
    ip route add 192.168.1.0/24 dev eth1


# ?
  - no dhcpoffer recived
  - [linux ftrace](https://www.kernel.org/doc/Documentation/trace/ftrace.txt)
    - reference
      https://lwn.net/Articles/410200/
      https://lwn.net/Articles/365835/
      http://elinux.org/Ftrace
    - boot config
      ```
      /proc/config.gz
      /boot/config
      /boot/config-$(uname -r)

      CONFIG_HAVE_FTRACE_NMI_ENTER=y
      CONFIG_HAVE_FUNCTION_TRACER=y
      CONFIG_HAVE_FUNCTION_GRAPH_TRACER=y
      CONFIG_HAVE_FUNCTION_GRAPH_FP_TEST=y
      CONFIG_HAVE_FUNCTION_TRACE_MCOUNT_TEST=y
      CONFIG_HAVE_DYNAMIC_FTRACE=y
      CONFIG_HAVE_FTRACE_MCOUNT_RECORD=y
      CONFIG_HAVE_SYSCALL_TRACEPOINTS=y
      CONFIG_TRACER_MAX_TRACE=y

      for running kernel configured with:
        CONFIG_IKCONFIG and CONFIG_IKCONFIG_PROC
      zcat /proc/config.gz > running.config
      ```

    - mount debugfs
      ```
      CONFIG_DEBUG_FS=y

      mount -t debugfs nodev /sys/kernel/debug/

      vim /etc/fstab
      debugfs       /sys/kernel/debug          debugfs defaults        0       0

      ln -s /sys/kernel/debug /debug

      # fs in use
        /etc/filesystems
        /proc/filesystems
      # all supported fs
      ls -l  /lib/modules/$(uname -r)/kernel/fs

    - trace system
      ```
      # list all event
      trace-cmd list -e 
      

      pgrep dhclient
      1764
      3668
      ps -p 1764,3668 -o pid,cmd -www
      trace-cmd record -p function -e *net* -c -P  1764 -o trace.dat
      trace-cmd record -p function_graph -e '*net*' -g ip_rcv -o dhclient.dat -F dhclient eth3
      trace-cmd report -i trace.dat -f irq -F 
      # permissions denied, can't create new file in debufs,sysfs(https://ubuntuforums.org/archive/index.php/t-2151624.html)
      ```

    - tracing specific cmd
      ```
      #!/bin/sh
      echo $$ > /debug/tracing/set_ftrace_pid
      # can set other filtering here
      echo function > /debug/tracing/current_tracer
      exec $*
      ```
      - trace 
        ```
        trace-cmd record -p function -F ls
        ```

    - trace over network
      ```
      # To set up a trace server, simply run something like the following command:
        trace-cmd listen -p 12345 -D -d /images/tracing/ -l /images/tracing/logfile
        # while the -d /images/tracing/ tells trace-cmd to output the trace files from the connections 
        # it receives into the /images/tracing/ directory.
        
      # in the client:
        trace-cmd record -N 192.168.1.131:12345 -e sched_switch -e sched_wakeup -e irq hackbench 50
      ```

    - for lazy user
      ``` 
      # tracing on and start tracing
       # trace-cmd start -p function_graph -g ip_rcv
       # sleep 10
       # trace-cmd stop # same as: echo 0 > /sys/kernel/debug/tracing/tracing_on
       # trace-cmd show # same as: cat /sys/kernel/debug/tracing/trace
       
      # save to file
       trace-cmd extract -o kernel-buf.dat
       trace-cmd report kernel-buf.dat

      # To disable all tracing, which will ensure that no overhead is left from using the function tracers or events, the reset command can be used.
        trace-cmd reset

# [sudoers](https://help.ubuntu.com/community/Sudoers)
  - https://www.sudo.ws/man/1.8.13/sudoers.man.html
  - file:/etc/sudoers 
	  control user for a machine with specific operations
  
  - contains following:
    - alias 
      Alias_Type NAME1 = item1, item2 : NAME2 = item3 
      - User_Alias:  specify groups of users including usernames, system groups(%), netgroups(+)
        ```
        # Everybody in the system group "admin" is covered by the alias ADMINS
        User_Alias ADMINS = %admin
        # The users "tom", "dick", and "harry" are covered by the USERS alias
        User_Alias USERS = tom, dick, harry
        # The users "tom" and "mary" are in the WEBMASTERS alias
        User_Alias WEBMASTERS = tom, mary
        # You can also use ! to exclude users from an alias
        # This matches anybody in the USERS alias who isn't in WEBMASTERS or ADMINS aliases
        User_Alias LIMITED_USERS = USERS, !WEBMASTERS, !ADMINS
        ```
            
      - Runas_Alias: same as user aliases except  specify users by uid's are allowed
        ```
        # UID 0 is normally used for root
        # Note the hash (#) on the following line indicates a uid, not a comment.
        Runas_Alias ROOT = #0
        # This is for all the admin users similar to the User_Alias of ADMINS set earlier 
        # with the addition of "root"
        Runas_Alias ADMINS = %admin, root
        ```
        
      - Host_Alias: a list of hostname, ip addresses, networks and netgroups (prefixed with +),
              hosts ethernet interface(s) will be used when matching if no netmask giving
        ```
        # This is all the servers
        Host_Alias SERVERS = 192.168.0.1, 192.168.0.2, server1
        # This is the whole network
        Host_Alias NETWORK = 192.168.0.0/255.255.255.0
        # And this is every machine in the network that is not a server
        Host_Alias WORKSTATIONS = NETWORK, !SERVER
        # This could have been done in one step with 
        # Host_Alias WORKSTATIONS = 192.168.0.0/255.255.255.0, !SERVERS
        # but I think this method is clearer.
        ```
        
      - Cmnd_Alias: lists of commands and directories(only include files in it no subdirectories included)
              following need to be escaped with a backslash (\): ",", "\", ":", "="
          ```
        # All the shutdown commands
        Cmnd_Alias SHUTDOWN_CMDS = /sbin/poweroff, /sbin/reboot, /sbin/halt
        # Printing commands
        Cmnd_Alias PRINTING_CMDS = /usr/sbin/lpc, /usr/sbin/lprm
        # Admin commands
        Cmnd_Alias ADMIN_CMDS = /usr/sbin/passwd, /usr/sbin/useradd, /usr/sbin/userdel, /usr/sbin/usermod, /usr/sbin/visudo
        # Web commands
        Cmnd_Alias WEB_CMDS = /etc/init.d/apache2
        ```
	
	  - User Specifications: where the sudoers file sets who can run what as who
		  <user list> <host list> = <operator list> <tag list> <command list>
      ```
      # This lets the webmasters run all the web commands on the machine 
      # "webserver" provided they give a password
      WEBMASTERS webserver= WEB_CMDS
      # This lets the admins run all the admin commands on the servers
      ADMINS SERVERS= ADMIN_CMDS
      # This lets all the USERS run admin commands on the workstations provided 
      # they give the root password or and admin password (using "sudo -u <username>")
      USERS WORKSTATIONS=(ADMINS) ADMIN_CMDS
      # This lets "harry" shutdown his own machine without a password
      harry harrys-machine= NOPASSWD: SHUTDOWN_CMDS
      # And this lets everybody print without requiring a password
      ALL ALL=(ALL) NOPASSWD: PRINTING_CMDS
      ```
	
    - configuration:
      ```
      vim /etc/sudoers.d/dolphin:
      # dolphin ALL=(ROOT:ROOT)  ALL

      Host_Alias DOLPHIN_M = 192.168.2.135

      Cmnd_Alias SHUTDOWN_CMNDS = /sbin/poweroff, /sbin/halt, /sbin/reboot
      Cmnd_Alias DOLPHIN_CMNDS = /usr/sbin, /usr/bin

      dolphin DOLPHIN_M= NOPASSWD: SHUTDOWN_CMDNS, DOLPHIN_CMDNS
      # dolphin ALL= NOPASSWD: SHUTDOWN_CMDNS, DOLPHIN_CMDNS
      ```

# network
  - cache
    ```
		nscd is the Name Service Caching Daemon
		nscd -g
		
    ip route show cache
		route -CFee
		Kernel IP routing table
		Destination     Gateway         Genmask         Flags Metric Ref    Use Iface    MSS   Window irtt
		default         gateway         0.0.0.0         UG    0      0        0 eth0     0     0      0
		192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth1     0     0      0
		192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0     0     0      0
		Kernel IP routing cache
		Source          Destination     Gateway         Flags Metric Ref    Use Iface    MSS   Window irtt  TOS HHRef HHUptod     SpecDst
    ```

# [SELinux](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security-Enhanced_Linux/sect-Security-Enhanced_Linux-Maintaining_SELinux_Labels_-Checking_the_Default_SELinux_Context.html)
  - introduction
    selinux checked after DAC, selinux policies won't be used if dac rules denys
    ```
    [root@centos test]# ls -aZ selinux.conf 
    -rw-r--r--. root root unconfined_u:object_r:user_tmp_t:s0 selinux.conf 
    ```
    SELinux provides following:
    - a user (unconfined_u) 
    - a role (object_r) 
    - a type(user_home_t)  or domain
      defines a domain of a process, a type for a file
    - a level (s0)

    - featues:
      - a type used for selinux policies to define how process interact with files amd interact with each other;
      - fine-grained access control, selinux use a user, role, type , level to make decisions;
      - selinux policies are administrative-defined, system-wide, not just for a user;
      - reduce PEA ;
      - can be used to enforce data intergration, confidentiality, and avoid uncontroled input dataflow;

    - state and mode
      - enforcing: selinux denys access based on selinux policies;
      - permissive: selinux is not enforing, selinux does not deny access, but denies are logged for actions that 
                    would deny if selinux is enforcing;
    
    - 

    - tools
      - Install semanage tools: sudo yum -y install policycoreutils-python
      - Allow port 88 for httpd: sudo semanage port -a -t http_port_t -p tcp 88
      - Allow port 8445 for httpd: sudo semanage port -a -t http_port_t -p tcp 8445
